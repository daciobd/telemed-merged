<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cadastro do M√©dico (demo) | TeleMed</title>
  <link rel="stylesheet" href="/assets/css/base.css" />
  <style>
    .container{max-width:820px;margin:36px auto;padding:16px}
    .subtitle{color:var(--muted);margin-bottom:16px}
    .card{background:#f3f7fb;border:1px solid rgba(0,0,0,.06);border-radius:16px;padding:24px;margin:16px 0}
    .info-box{background:#eef2ff;border:1px solid rgba(37,99,235,.2);border-radius:12px;padding:16px;margin:16px 0}
    .form-group{margin-bottom:16px}
    label{display:block;font-weight:600;margin-bottom:6px}
    input,select,textarea{width:100%;padding:10px;border:1px solid rgba(0,0,0,.12);border-radius:8px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:720px){.row{grid-template-columns:1fr}}
    .actions,.actions-row{display:flex;gap:12px;flex-wrap:wrap;margin-top:20px}
    .muted{color:var(--muted)}
  </style>
</head>
<body>
  <div class="container">
    <h1>üë®‚Äç‚öïÔ∏è Cadastro do M√©dico (demo)</h1>
    <div class="subtitle">Complete seu perfil profissional para come√ßar a atender</div>

    <div class="info-box">
      <strong>üìã Demonstra√ß√£o:</strong> Este formul√°rio n√£o armazena dados reais. Use para testar o fluxo.
    </div>

    <form id="form-cadastro-medico" data-form="cadastro-medico" class="card">
      <div class="row">
        <div class="form-group">
          <label for="nome">Nome completo *</label>
          <input id="nome" required placeholder="Dr. Jo√£o Silva" data-testid="input-nome" />
        </div>
        <div class="form-group">
          <label for="crm">CRM *</label>
          <input id="crm" required placeholder="12345-SP" data-testid="input-crm" />
        </div>
      </div>

      <div class="row">
        <div class="form-group">
          <label for="email">E-mail *</label>
          <input id="email" type="email" required placeholder="medico@exemplo.com" data-testid="input-email" />
        </div>
        <div class="form-group">
          <label for="telefone">Telefone</label>
          <input id="telefone" type="tel" placeholder="(11) 98765-4321" data-testid="input-telefone" />
        </div>
      </div>

      <div class="form-group">
        <label for="especialidades">Especialidades *</label>
        <select id="especialidades" required data-testid="select-especialidades">
          <option value="">Selecione...</option>
          <option value="clinica-geral">Cl√≠nica Geral</option>
          <option value="cardiologia">Cardiologia</option>
          <option value="dermatologia">Dermatologia</option>
          <option value="pediatria">Pediatria</option>
          <option value="psiquiatria">Psiquiatria</option>
          <option value="outra">Outra</option>
        </select>
      </div>

      <div class="form-group">
        <label for="bio">Mini biografia (opcional)</label>
        <textarea id="bio" rows="3" placeholder="Conte um pouco sobre sua experi√™ncia e forma de atendimento..." data-testid="input-bio"></textarea>
      </div>

      <div class="row">
        <div class="form-group">
          <label for="valorMin">Valor m√≠nimo por consulta (R$)</label>
          <input id="valorMin" type="number" min="50" placeholder="120" data-testid="input-valor" />
        </div>
        <div class="form-group">
          <label for="disponibilidade">Disponibilidade</label>
          <select id="disponibilidade" data-testid="select-disponibilidade">
            <option value="manha">Manh√£</option>
            <option value="tarde">Tarde</option>
            <option value="noite">Noite</option>
            <option value="flexivel">Flex√≠vel</option>
          </select>
        </div>
      </div>

      <div class="actions-row" id="actions" data-actions>
        <button type="submit" class="btn" data-cta="med_cad_salvar" data-testid="button-salvar">Salvar cadastro</button>
        <button type="reset" class="btn btn-secondary" data-cta="med_cad_limpar" data-testid="button-limpar">Limpar</button>
        <a id="btn-demo-medico" class="btn" href="/public/medico-demo.html" data-cta="med_cad_ir_demo" data-testid="button-ir-demo">Ir para Demo M√©dico</a>
        <a id="btn-ja-tenho-cadastro" class="btn btn-secondary" href="/public/medico-login.html" data-cta="med_cad_login" data-testid="button-ja-cadastro">J√° tenho cadastro</a>
      </div>
    </form>

    <p style="margin-top:16px"><a href="/public/como-funciona-medico.html" class="muted" data-testid="link-back">‚Üê Voltar</a></p>
  </div>

  <script defer>
    document.addEventListener('DOMContentLoaded', () => {
      // Helper seguro para addEventListener
      const on = (selOrEl, type, handler, opts) => {
        const el = typeof selOrEl === 'string' ? document.querySelector(selOrEl) : selOrEl;
        if (!el) { 
          console.warn('Elemento n√£o encontrado:', selOrEl); 
          return; 
        }
        el.addEventListener(type, handler, opts);
      };

      const byId = (id) => document.getElementById(id);

      // Telemetria page view
      try {
        window.Telemetry?.event?.({event_name:'page_view',meta:{page:'/public/cadastro-medico.html'}});
      } catch(e) {}

      // Encontrar form com m√∫ltiplos seletores (fallback)
      const form = 
        byId('form-cadastro-medico') ||
        document.querySelector('form[data-form="cadastro-medico"]') ||
        document.querySelector('main form') ||
        document.querySelector('form');

      // Form submit usando helper on()
      on(form, 'submit', (e) => {
        e.preventDefault();
        alert('‚úÖ Cadastro simulado com sucesso! Redirecionando para o Demo do M√©dico...');
        setTimeout(() => {
          location.href = '/public/medico-demo.html';
        }, 1000);
      });

      // Telemetria CTAs usando helper on()
      document.querySelectorAll('[data-cta]').forEach(el => {
        on(el, 'click', () => {
          try {
            window.Telemetry?.event?.({event_name:'cta_click',meta:{name:el.dataset.cta}});
          } catch(e) {}
        });
      });

      // Encontrar container de a√ß√µes com m√∫ltiplos seletores
      let actions =
        document.querySelector('[data-actions]') ||
        byId('actions') ||
        document.querySelector('.actions-row') ||
        document.querySelector('.form-actions');

      // Fallback: buscar submit e pegar o parent
      if (!actions && form) {
        const submit = form.querySelector('button[type="submit"], [type="submit"].btn');
        actions = submit?.closest('div, section, footer, fieldset') || null;
      }

      // √öltimo fallback: criar container
      if (!actions && form) {
        actions = document.createElement('div');
        actions.id = 'actions';
        actions.className = 'actions-row';
        form.appendChild(actions);
      }

      // Fun√ß√£o para garantir que bot√£o existe (sem duplica√ß√£o)
      const ensure = (id, html) => {
        if (!actions) return;
        if (!byId(id)) {
          actions.insertAdjacentHTML('beforeend', html);
        }
      };

      // Garante bot√µes principais
      ensure('btn-demo-medico',
        `<a id="btn-demo-medico" class="btn" href="/public/medico-demo.html" data-cta="med_cad_ir_demo" data-testid="button-ir-demo">Ir para Demo M√©dico</a>`);
      ensure('btn-ja-tenho-cadastro',
        `<a id="btn-ja-tenho-cadastro" class="btn btn-secondary" href="/public/medico-login.html" data-cta="med_cad_login" data-testid="button-ja-cadastro">J√° tenho cadastro</a>`);

      // Move/esconde o "Hub" para Op√ß√µes avan√ßadas
      const hubLink = [...document.querySelectorAll('a')]
        .find(a => /hub/i.test(a.textContent||''));
      if (hubLink) {
        let det = byId('opcoes-avancadas');
        if (!det) {
          det = document.createElement('details');
          det.id = 'opcoes-avancadas';
          const sum = document.createElement('summary');
          sum.textContent = 'Op√ß√µes avan√ßadas (para equipes t√©cnicas)';
          sum.className = 'muted';
          det.appendChild(sum);
          if (actions?.parentNode) {
            actions.parentNode.insertBefore(det, actions.nextSibling);
          }
        }
        const p = document.createElement('p');
        p.appendChild(hubLink);
        det.appendChild(p);
      }
    });
  </script>
</body>
</html>
