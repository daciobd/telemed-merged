<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BidConnect Standalone - 3 Modelos | TeleMed</title>
  <meta name="description" content="Demonstra√ß√£o dos 3 modelos de precifica√ß√£o din√¢mica do BidConnect: Conservador, Sugestivo (IA) e Din√¢mico.">
  
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel Standalone para JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    body { margin: 0; padding: 0; font-family: system-ui, -apple-system, sans-serif; background: #f9fafb; }
    .app { max-width: 900px; margin: 0 auto; padding: 24px; }
    .hero { margin-bottom: 20px; }
    .hero h1 { font-size: 28px; font-weight: 800; margin: 0 0 8px; color: #1f2937; }
    .hero p { font-size: 15px; color: #6b7280; margin: 0; }
    .card { background: white; border-radius: 16px; padding: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 16px; }
    .btn { display: inline-block; padding: 10px 16px; border-radius: 10px; font-weight: 600; font-size: 14px; border: 1px solid #d1d5db; background: white; color: #374151; cursor: pointer; text-decoration: none; transition: all 0.2s; }
    .btn:hover { background: #f3f4f6; transform: translateY(-1px); }
    .btn.primary { background: #2563eb; color: white; border-color: #2563eb; }
    .btn.primary:hover { background: #1d4ed8; }
    .cta { display: inline-block; padding: 8px 14px; border-radius: 8px; font-weight: 700; font-size: 13px; border: none; background: #16a34a; color: white; cursor: pointer; transition: all 0.2s; }
    .cta:hover { background: #15803d; transform: translateY(-1px); }
    .priceBadge { font-size: 36px; font-weight: 900; color: #2563eb; margin: 8px 0; }
    .slider { width: 100%; height: 6px; border-radius: 999px; background: #e5e7eb; outline: none; appearance: none; }
    .slider::-webkit-slider-thumb { appearance: none; width: 24px; height: 24px; border-radius: 50%; background: #2563eb; cursor: pointer; }
    .slider::-moz-range-thumb { width: 24px; height: 24px; border-radius: 50%; background: #2563eb; cursor: pointer; border: none; }
    .markers { display: flex; justify-content: space-between; font-size: 12px; color: #6b7280; margin-top: 6px; }
    .row { display: flex; gap: 8px; margin-top: 12px; flex-wrap: wrap; }
    .availability { border-radius: 12px; padding: 16px; margin-top: 16px; }
    .availability.good { background: #ecfdf5; border: 2px solid #10b981; }
    .availability.low { background: #fef3c7; border: 2px solid #f59e0b; }
    .avHead { margin-bottom: 12px; }
    .statusIcon { font-size: 28px; }
    .statusMsg { font-weight: 800; font-size: 16px; color: #1f2937; margin-top: 6px; }
    .statusDesc { font-size: 14px; color: #6b7280; margin-top: 2px; }
    .docs { display: grid; gap: 12px; margin-top: 12px; }
    .doc { display: grid; grid-template-columns: 40px 1fr auto; gap: 12px; align-items: center; background: white; padding: 12px; border-radius: 10px; border: 1px solid #e5e7eb; }
    .avatar { width: 40px; height: 40px; border-radius: 50%; background: #dbeafe; display: flex; align-items: center; justify-content: center; font-size: 20px; }
    .name { font-weight: 700; font-size: 14px; color: #1f2937; }
    .spec { font-size: 12px; color: #6b7280; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo } = React;

    // STANDALONE MODE: SEMPRE USA MOCK - ZERO NETWORK
    console.info("[BidConnect Standalone] ‚öôÔ∏è Modo MOCK embutido - zero network");
    
    const API = {
      createBid: async ({ amount }) => {
        await new Promise(resolve => setTimeout(resolve, 200));
        return { ok: true, bid: { id: "BID-DEMO", amount } };
      },
      
      search: async ({ bidId, amount }) => {
        await new Promise(resolve => setTimeout(resolve, 300));
        
        if (amount >= 180) {
          return {
            ok: true,
            immediate_doctors: [
              { id: "D1", name: "Dr. Silva", spec: "Cl√≠nica Geral" },
              { id: "D2", name: "Dra. Santos", spec: "Pediatria" },
            ],
            scheduled_doctors: [
              { id: "D9", name: "Dr. Souza", time: "+30 min" },
              { id: "D10", name: "Dra. Maia", time: "+60 min" },
            ],
          };
        }
        return { ok: true, immediate_doctors: [], scheduled_doctors: [] };
      },
      
      accept: async ({ doctorId }) => {
        await new Promise(resolve => setTimeout(resolve, 250));
        return { ok: true, consultation_id: `CONS-${doctorId}-${Date.now()}` };
      },
    };

    const formatBRL = (v) => new Intl.NumberFormat("pt-BR", { style: "currency", currency: "BRL" }).format(v);

    function TelemedStandalone() {
      const MODEL = new URLSearchParams(location.search).get('model') || 'conservative';
      const THEMES = {
        conservative: { label: 'Conservador', color: '#2563eb' },
        suggestive:   { label: 'Sugestivo (IA)', color: '#7c3aed' },
        dynamic:      { label: 'Din√¢mico', color: '#16a34a' },
      };
      const theme = THEMES[MODEL];

      const [value, setValue]   = useState(140);
      const [busy, setBusy]     = useState(false);
      const [result, setResult] = useState(null);
      const [bidId, setBidId]   = useState(null);
      const [aiTip, setAiTip]   = useState(null);

      async function runSearch(forcedValue) {
        const searchValue = forcedValue || value;
        console.log(`[BidConnect] runSearch called - MODEL: ${MODEL}, searchValue: ${searchValue}, forcedValue: ${forcedValue}`);
        setBusy(true); setResult(null);
        try {
          // Comportamento especial do Sugestivo (IA):
          if (MODEL === 'suggestive' && searchValue < 180) {
            // Mostra sugest√£o (sem chamar "rede")
            console.log('[BidConnect] Mostrando sugest√£o IA (valor < 180)');
            setAiTip({ price: 195, chance: 85, immediates: 2 });
            setBusy(false);
            return;
          }
          // Limpa sugest√£o se estiver fazendo busca normal
          setAiTip(null);
          console.log('[BidConnect] Fazendo busca normal (valor >= 180 ou n√£o-IA)');
          const created = await API.createBid({ amount: searchValue });
          setBidId(created.bid.id);
          const found = await API.search({ bidId: created.bid.id, amount: searchValue });
          setResult(found);
          console.group(`[${MODEL}] üîé search`);
          console.log('bid', created.bid); console.log('found', found);
          console.groupEnd();
        } finally {
          setBusy(false);
        }
      }

      function acceptSuggestion() {
        setAiTip(null);
        setValue(195);
        setTimeout(() => runSearch(195), 50);
      }

      function TierGrid() {
        if (MODEL !== 'dynamic') return null;
        const tiers = [
          { label:'Econ√¥mico', min:140, max:159, immediate:0, scheduled:2, wait:'2‚Äì4 h' },
          { label:'Padr√£o',    min:160, max:179, immediate:1, scheduled:5, wait:'30‚Äì60 min' },
          { label:'R√°pido',    min:180, max:199, immediate:3, scheduled:8, wait:'5‚Äì15 min' },
          { label:'Premium',   min:200, max:250, immediate:7, scheduled:12, wait:'Imediato' },
        ];
        const active = tiers.find(t => value >= t.min && value <= t.max) || tiers[0];
        return (
          <div style={{marginTop:16}}>
            <div style={{fontWeight:800,marginBottom:8}}>Faixas de pre√ßo ‚Äî mercado em tempo real</div>
            <div style={{display:'grid',gap:8,gridTemplateColumns:'repeat(auto-fit,minmax(180px,1fr))'}}>
              {tiers.map(t => (
                <div key={t.label}
                  style={{
                    border:'2px solid', borderColor: t===active ? theme.color : '#e5e7eb',
                    borderRadius:12, padding:12, background:t===active ? '#f8fafc' : '#fff', cursor:'pointer'
                  }}
                  onClick={()=> { setValue(Math.min(t.max, Math.max(t.min, value))); setResult(null); }}
                >
                  <div style={{fontWeight:800, marginBottom:6}}>{t.label}</div>
                  <div style={{fontSize:13, color:'#334155', marginBottom:6}}>R$ {t.min} ‚Äì R$ {t.max}</div>
                  <div style={{fontSize:12}}>‚ö° {t.immediate} imediato(s) ‚Ä¢ üìÖ {t.scheduled} agendados ‚Ä¢ ‚è± {t.wait}</div>
                  {t.immediate>0 && t===active && (
                    <button className="cta" style={{marginTop:8, background:theme.color}}
                            onClick={(e)=>{ e.stopPropagation(); runSearch(); }}>
                      Atender Agora
                    </button>
                  )}
                </div>
              ))}
            </div>
          </div>
        );
      }

      function AIBanner() {
        if (MODEL !== 'suggestive') return null;
        return (
          <div style={{background:'#f5f3ff',border:'1px solid #e9d5ff',color:'#4c1d95',padding:10,
                       borderRadius:10, marginBottom:12}}>
            A IA sugere o melhor pre√ßo para voc√™ ‚Äî experimente "Buscar com IA" em R$ 160.
          </div>
        );
      }

      function AISuggestionCard() {
        console.log('[BidConnect] AISuggestionCard render - aiTip:', aiTip);
        if (!aiTip) return null;
        return (
          <div style={{background:'#fff',border:'2px dashed #7c3aed',padding:14,borderRadius:12, marginTop:12}}>
            <div style={{fontWeight:800, color:'#7c3aed', marginBottom:6}}>üí° Sugest√£o Inteligente</div>
            <div style={{fontSize:14, marginBottom:8}}>
              Com <b>R$ {aiTip.price}</b> voc√™ tem <b>{aiTip.chance}%</b> de chance de atendimento imediato
              (‚âà {aiTip.immediates} m√©dico(s) agora).
            </div>
            <div style={{display:'flex',gap:8}}>
              <button className="cta" style={{background:'#7c3aed'}} onClick={acceptSuggestion}>Aceitar Sugest√£o</button>
              <button className="btn" onClick={()=>setAiTip(null)}>Manter R$ {value}</button>
            </div>
          </div>
        );
      }

      return (
        <div className="app">
          {/* Cabe√ßalho com badge do modelo */}
          <div className="hero" style={{marginBottom:12}}>
            <h1 style={{display:'inline-flex',alignItems:'center',gap:8}}>
              BidConnect ‚Äî <span style={{
                background:theme.color,color:'#fff',borderRadius:999,padding:'3px 10px',fontSize:14
              }}>{theme.label}</span>
            </h1>
            <p style={{opacity:.9}}>
              {MODEL==='conservative' && 'Paciente prop√µe, sistema busca e voc√™ decide.'}
              {MODEL==='suggestive'   && 'IA recomenda valores com maior chance de atendimento imediato.'}
              {MODEL==='dynamic'      && 'Transpar√™ncia de oferta e tempo por faixas de pre√ßo.'}
            </p>

            {/* Abas para alternar rapidamente */}
            <div style={{marginTop:8, display:'flex', gap:8, flexWrap:'wrap'}}>
              <a className="btn" href="?model=conservative">Conservador</a>
              <a className="btn" href="?model=suggestive">Sugestivo (IA)</a>
              <a className="btn" href="?model=dynamic">Din√¢mico</a>
            </div>
          </div>

          {/* Banner do IA (apenas no modelo IA) */}
          <AIBanner/>

          <div className="card">
            {/* Como funciona */}
            <div className="card" style={{border:'1px solid #e5e7eb', background:'#f8fafc', marginBottom:12}}>
              <strong>Como funciona</strong>
              <ol style={{marginTop:6, paddingLeft:18}}>
                <li>Voc√™ prop√µe um valor</li>
                <li>Buscamos m√©dicos dispon√≠veis neste valor</li>
                <li>Se n√£o houver, voc√™ pode aumentar e tentar novamente</li>
              </ol>
            </div>

            {/* Slider */}
            <div style={{margin:'10px 0'}}>
              <div style={{fontSize:12, color:'#475569', marginBottom:4}}>Quanto deseja pagar?</div>
              <div className="priceBadge" style={{marginBottom:8}}>{formatBRL(value)}</div>
              <input className="slider" type="range" min={100} max={300} value={value}
                     onChange={(e)=>{ setValue(parseInt(e.target.value,10)); setResult(null); setAiTip(null); }}/>
              <div className="markers">
                <div>Min: R$ 100</div>
                <div>Recomendado: R$ 180</div>
                <div>M√°x: R$ 300</div>
              </div>
              <div className="row">
                {[140,160,180,200,220].map(v => (
                  <button key={v} className="btn" onClick={()=>{ setValue(v); setResult(null); setAiTip(null); }}
                          style={{background:'#eee'}}>R$ {v}</button>
                ))}
              </div>

              {/* Bot√£o principal muda o r√≥tulo no IA */}
              <div className="row">
                <button className="btn primary"
                        style={{background:theme.color}}
                        onClick={() => runSearch()}
                        disabled={busy}>
                  {busy ? 'Buscando‚Ä¶' : (MODEL==='suggestive' ? 'Buscar com IA' : 'Buscar M√©dicos Dispon√≠veis')}
                </button>
              </div>
            </div>

            {/* Card de sugest√£o (IA) */}
            <AISuggestionCard/>

            {/* Grid de faixas (Din√¢mico) */}
            <TierGrid/>

            {/* Resultado padr√£o (verde/amarelo) */}
            {result && (
              <div className={'availability ' + (result.immediate_doctors?.length>0 ? 'good' : 'low')}>
                <div className="avHead">
                  <span className="statusIcon">{result.immediate_doctors?.length>0?'‚ö°':'‚è≥'}</span>
                  <div className="statusMsg">
                    {result.immediate_doctors?.length>0
                      ? 'M√©dicos dispon√≠veis agora!'
                      : 'Sem atendimento imediato; h√° op√ß√µes para agendar'}
                  </div>
                  <div className="statusDesc">
                    {result.immediate_doctors?.length>0
                      ? `${result.immediate_doctors.length} imediato(s)`
                      : `${result.scheduled_doctors?.length||0} para agendar`}
                  </div>
                </div>

                {/* Imediatos */}
                {result.immediate_doctors?.length>0 && (
                  <div className="docs">
                    {result.immediate_doctors.map(d => (
                      <div className="doc" key={d.id}>
                        <div className="avatar">‚ö°</div>
                        <div>
                          <div className="name">{d.name}</div>
                          <div className="spec">{d.spec||'Cl√≠nico'} ‚Äî dispon√≠vel agora</div>
                        </div>
                        <button className="cta" style={{background:theme.color}}
                                onClick={async ()=>{
                                  const r = await API.accept({ doctorId: d.id, bidId });
                                  alert(`Consulta confirmada! ID: ${r.consultation_id}`);
                                }}>
                          Aceitar por {formatBRL(value)}
                        </button>
                      </div>
                    ))}
                  </div>
                )}

                {/* Agendados */}
                {result.scheduled_doctors?.length>0 && (
                  <div className="docs">
                    {result.scheduled_doctors.map(d => (
                      <div className="doc" key={d.id}>
                        <div className="avatar">üìÖ</div>
                        <div>
                          <div className="name">{d.name}</div>
                          <div className="spec">Hor√°rio: {d.time}</div>
                        </div>
                        <button className="cta" style={{background:theme.color}}
                                onClick={async ()=>{
                                  const r = await API.accept({ doctorId: d.id, bidId });
                                  alert(`Agendado! ID: ${r.consultation_id}`);
                                }}>
                          Agendar por {formatBRL(value)}
                        </button>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            )}

          </div>
        </div>
      );
    }

    // Render - React 18
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<TelemedStandalone/>);
  </script>
</body>
</html>
